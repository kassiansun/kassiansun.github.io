<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Kassian Sun</title>
<meta name=keywords content><meta name=description content="Posts - Kassian Sun"><meta name=author content><link rel=canonical href=https://blog.kassiansun.com/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.kassiansun.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.kassiansun.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.kassiansun.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.kassiansun.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.kassiansun.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://blog.kassiansun.com/posts/index.xml><link rel=alternate hreflang=en href=https://blog.kassiansun.com/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-E9FSQ1R0HV"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E9FSQ1R0HV")}</script><meta property="og:title" content="Posts"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://blog.kassiansun.com/posts/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.kassiansun.com/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.kassiansun.com/ accesskey=h title="Kassian Sun (Alt + H)">Kassian Sun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.kassiansun.com/about title=About><span>About</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Go Runtime Implementation: CGO</h2></header><div class=entry-content><p>Code Path: src/runtime/cgocall.go The key part here is to switch the stack between Go and CGO
Go -> C cgocall entersyscall: this will ensure that CGO codes will not block the Go runtime. mark m as incgo asmcgocall KeepAlive CGO-related fn, arg, and mp asmcgocall Set-up the stack. C -> Go cgocallback Set-up the stack for cgocallbackg, after cgocallbackg, the sp will point to the previous code called cgocallback cgocallbackg callbackUpdateSystemStack lockOSThread to pin the g on the current m exitsyscall cgocallbackg1 undo the previous steps reentersyscall</p></div><footer class=entry-footer><span title='2024-07-16 13:41:49 +0800 +0800'>July 16, 2024</span></footer><a class=entry-link aria-label="post link to Go Runtime Implementation: CGO" href=https://blog.kassiansun.com/posts/go-source-code-part-21/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Go Runtime Implementations: Defer, Panic and Recover</h2></header><div class=entry-content><p>Code Path: src/runtime/panic.go Ref: Defer, Panic, and Recover Defer Two methods of defer Copied from the comment:
The older way involves creating a defer record at the time that a defer statement is executing and adding it to a defer chain. This chain is inspected by the deferreturn call at all function exits in order to run the appropriate defer calls.
A cheaper way (which we call open-coded defers) is used for functions in which no defer statements occur in loops....</p></div><footer class=entry-footer><span title='2023-06-25 14:18:47 +0800 +0800'>June 25, 2023</span></footer><a class=entry-link aria-label="post link to Go Runtime Implementations: Defer, Panic and Recover" href=https://blog.kassiansun.com/posts/go-source-code-part-20/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Set Up OpenLDAP and phpldapadmin on Ubuntu 22.04</h2></header><div class=entry-content><p>Install LDAP Before install ldap, set-up a valid FQDN for your hostname:
Edit /etc/hostname, for example void.kassiansun.com Restart the host If you’ve installed ldap before, purge them all:
sudo apt-get remove --purge slapd ldap-utils -y Now we can install the ldap packages:
sudo apt-get install slapd ldap-utils -y During the installation, it will prompt to set the default password.
Test that you now have a valid LDAP tree:
# Output: # dn: # namingContexts: dc=kassiansun,dc=com ldapsearch -H ldap://localhost -x -LLL -s base -b "" namingContexts Clean-Up Old apache2 and php installation sudo apt-get remove --purge apache2 phpldapadmin php* If you’re not using apache or php on your machine, clean them all so we can get started from the scratch....</p></div><footer class=entry-footer><span title='2023-06-16 15:49:24 +0800 +0800'>June 16, 2023</span></footer><a class=entry-link aria-label="post link to Set Up OpenLDAP and phpldapadmin on Ubuntu 22.04" href=https://blog.kassiansun.com/posts/ldap-ubuntu-22.04/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Redis Internal: List Types</h2></header><div class=entry-content><p>The Generic Set Implementation Code Path: src/t_set.c It’s a wrapper around the actual set type. The set can be one of the following types:
An intset. Even if the member is a string, Redis will try to convert it to an integer with string2ll. A listpack. Used for small sets. A dict. Used for large sets. Listpack Implementation The same implementation of hash type.
Dict Implementation The same implementation of hash type....</p></div><footer class=entry-footer><span title='2023-01-18 14:21:09 +0800 +0800'>January 18, 2023</span></footer><a class=entry-link aria-label="post link to Redis Internal: List Types" href=https://blog.kassiansun.com/posts/redis-set/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Redis Internal: List Types</h2></header><div class=entry-content><p>The Generic List Implementation Code Path: src/t_list.c It’s a Redis command wrapper of listpack and quicklist.
Listpack Implementation The same implementation of hash type.
Quicklist Implementation Code Path: src/quicklist.c If the size of the list exceeds a certain number, Redis will try to convert a listpack to quicklist. A quicklist is a double-linked list of listpack:
If the data is too large, it will store the data as a “plain” node, without encoding it as listpack....</p></div><footer class=entry-footer><span title='2023-01-03 11:55:05 +0800 +0800'>January 3, 2023</span></footer><a class=entry-link aria-label="post link to Redis Internal: List Types" href=https://blog.kassiansun.com/posts/redis-list/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Redis Internal: Hash Types</h2></header><div class=entry-content><p>The Generic Hash Implementation Code Path: src/t_hash.c The generic hash type is a wrapper around listpack and dict, it will switch between two different implementation and call the routines accordingly.
Listpack Implementation Code Path: src/listpack.c Listpack is a densed storage of a series of keys and values, it supports storing both integers and strings. If the hash size is lower than hash_max_listpack_value, it will be saved as a listpack. If the hash size is higher than hash_max_listpack_value, it will create a dict and copy the data from listpack to the dict....</p></div><footer class=entry-footer><span title='2022-11-26 10:15:35 +0800 +0800'>November 26, 2022</span></footer><a class=entry-link aria-label="post link to Redis Internal: Hash Types" href=https://blog.kassiansun.com/posts/redis-hash/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Go Runtime Implementations: Map</h2></header><div class=entry-content><p>Code Path: src/runtime/map.go makemap Each hmap has a hash0 as seed hash. When the compiler generates the typing information for a map, the hasher function will be calculated with genhash function (code path: src/cmd/compile/internal/reflectdata/alg.go).
If the map is not escaped, the hmap will be allocated by the compiler on the stack.
Then makemap will allocate an array of bucket, the type of bucket is generated at compiling stage by MapBucketType (code path: src/cmd/compile/internal/reflectdata/reflect....</p></div><footer class=entry-footer><span title='2022-11-23 16:51:25 +0800 +0800'>November 23, 2022</span></footer><a class=entry-link aria-label="post link to Go Runtime Implementations: Map" href=https://blog.kassiansun.com/posts/go-source-code-part-19/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Redis Architecture</h2></header><div class=entry-content><p>Start-Up Procedures spt_init: This procedure initializes the process’s name and deep copy command-line arguments & environments. tzset. zmalloc_set_oom_handler init_genrand64 with timestamp and pid number. Code Path: mt19937-64.c crc64_init. Code Path: crc64.c umask dictSetHashFunctionSeed with a random 16-byte seed. Code Path: dict.c initServerConfig ACLInit. Code Path: acl.c moduleInitModulesSystem. Code Path: module.c connTypeInitialize. Code Path: connection.c initSentinelConfig and initSentinel if the server was started in sentinel mode. Code Path: sentinel.c Run redis_check_aof_main or redis_check_rdb_main and exit....</p></div><footer class=entry-footer><span title='2022-11-10 15:21:10 +0800 +0800'>November 10, 2022</span></footer><a class=entry-link aria-label="post link to Redis Architecture" href=https://blog.kassiansun.com/posts/redis-architecture/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Go Runtime Implementations: Timer Scheduling</h2></header><div class=entry-content><p>Code Path: src/runtime/time.go time.startTimer (implemented as addtimer) Each p has a timers list. When a user is adding a new timer, it will first try to clean up the timers list, then adds the new timer. Each timers list is a heap sorted by timer.when, and will be updated during add/delete timers.
cleantimers cleantimers only checks the head of the timers list.
Check if it’s timerDeleted, delete it from the timers list, and update p’s timer0When....</p></div><footer class=entry-footer><span title='2022-11-07 08:49:37 +0800 +0800'>November 7, 2022</span></footer><a class=entry-link aria-label="post link to Go Runtime Implementations: Timer Scheduling" href=https://blog.kassiansun.com/posts/go-source-code-part-18/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Go Runtime Implementations: Network Polling</h2></header><div class=entry-content><p>Code Path: src/runtime/netpoll.go Network polling is platform-dependent, the following is of BSD family operating systems (based on kqueue).
netpollinit Initialize a kqueue descriptor, and set CLOSEXEC flag on it. Initialize a non-blocking pipe, and use the reader/writer for netpollBreak. netpollBreak will try to write to the pipe and interrupt the kevent. netpoll netpoll is used to check the connections and return a list of g ready to run. It can block for delay ns at most....</p></div><footer class=entry-footer><span title='2022-11-05 08:56:11 +0800 +0800'>November 5, 2022</span></footer><a class=entry-link aria-label="post link to Go Runtime Implementations: Network Polling" href=https://blog.kassiansun.com/posts/go-source-code-part-17/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://blog.kassiansun.com/posts/page/2/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2024 <a href=https://blog.kassiansun.com/>Kassian Sun</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>