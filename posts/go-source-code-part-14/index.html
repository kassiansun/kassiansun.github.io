<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Go Runtime Implementations: Interfaces | Kassian Sun</title><meta name=keywords content="go"><meta name=description content="Static Definition and Initialization Code Path: src/runtime/iface.go In proc.go, itabsinit will init the itabTable with the current activeModules information. The itabsinit function will read the itablinks from each module and add them to the global hash table.
During the runtime, the getitab function will also build more items dynamically and fill the hash table accordingly.
itablinks was produced for each module during the linking stage, and contains an array of itab."><meta name=author content><link rel=canonical href=https://kassiansun.github.io/posts/go-source-code-part-14/><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kassiansun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kassiansun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kassiansun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kassiansun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kassiansun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-E9FSQ1R0HV"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E9FSQ1R0HV",{anonymize_ip:!1})}</script><meta property="og:title" content="Go Runtime Implementations: Interfaces"><meta property="og:description" content="Static Definition and Initialization Code Path: src/runtime/iface.go In proc.go, itabsinit will init the itabTable with the current activeModules information. The itabsinit function will read the itablinks from each module and add them to the global hash table.
During the runtime, the getitab function will also build more items dynamically and fill the hash table accordingly.
itablinks was produced for each module during the linking stage, and contains an array of itab."><meta property="og:type" content="article"><meta property="og:url" content="https://kassiansun.github.io/posts/go-source-code-part-14/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-27T10:16:17+08:00"><meta property="article:modified_time" content="2022-10-27T10:16:17+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go Runtime Implementations: Interfaces"><meta name=twitter:description content="Static Definition and Initialization Code Path: src/runtime/iface.go In proc.go, itabsinit will init the itabTable with the current activeModules information. The itabsinit function will read the itablinks from each module and add them to the global hash table.
During the runtime, the getitab function will also build more items dynamically and fill the hash table accordingly.
itablinks was produced for each module during the linking stage, and contains an array of itab."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kassiansun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Go Runtime Implementations: Interfaces","item":"https://kassiansun.github.io/posts/go-source-code-part-14/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go Runtime Implementations: Interfaces","name":"Go Runtime Implementations: Interfaces","description":"Static Definition and Initialization Code Path: src/runtime/iface.go In proc.go, itabsinit will init the itabTable with the current activeModules information. The itabsinit function will read the itablinks from each module and add them to the global hash table.\nDuring the runtime, the getitab function will also build more items dynamically and fill the hash table accordingly.\nitablinks was produced for each module during the linking stage, and contains an array of itab.","keywords":["go"],"articleBody":"Static Definition and Initialization Code Path: src/runtime/iface.go In proc.go, itabsinit will init the itabTable with the current activeModules information. The itabsinit function will read the itablinks from each module and add them to the global hash table.\nDuring the runtime, the getitab function will also build more items dynamically and fill the hash table accordingly.\nitablinks was produced for each module during the linking stage, and contains an array of itab. itab is generated by writeITab function (code path: cmd/compile/internal/reflectdata/reflect.go), used to store the type link between a concrete type (_type field) implementing an interface (inter field). If _type doesn’t implement inter, fun will be empty; else it will save the methods of _type implementing inter (not all methods of _type).\nRuntime Type Assertion Code Path: src/cmd/compile/internal/ssagen/ssa.go A type assertion is something like y = x.(T), it’s executed during runtime instead of compiling stage (e.g. generics). The SSA module will generate the code with dottype function.\nInterface Type Conversion Code Path: src/cmd/compile/internal/walk/convert.go Interface-to-interface conversion is done during IR walking, walkConvInterface will check the types of source and destination types, and only an interface-to-interface conversion needs a runtime call to convI2I.\nConcrete type to interface conversion is done by walkConvIData. It will use dataWordFuncName to check the correct conversion implementation defined in iface.go.\nRuntime Interface Method Call Code Path: src/cmd/compile/internal/walk/expr.go An interface call (x.A()) will be walked by walkCall. Note that ir.ODOTINTER are ir.OCALLINTER the same for an interface, because interfaces don’t have any fields so they’ll always be method calls.\n","wordCount":"250","inLanguage":"en","datePublished":"2022-10-27T10:16:17+08:00","dateModified":"2022-10-27T10:16:17+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kassiansun.github.io/posts/go-source-code-part-14/"},"publisher":{"@type":"Organization","name":"Kassian Sun","logo":{"@type":"ImageObject","url":"https://kassiansun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kassiansun.github.io/ accesskey=h title="Kassian Sun (Alt + H)">Kassian Sun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kassiansun.github.io/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Go Runtime Implementations: Interfaces</h1><div class=post-meta><span title='2022-10-27 10:16:17 +0800 +0800'>October 27, 2022</span></div></header><div class=post-content><h2 id=static-definition-and-initialization>Static Definition and Initialization<a hidden class=anchor aria-hidden=true href=#static-definition-and-initialization>#</a></h2><ul><li>Code Path: <code>src/runtime/iface.go</code></li></ul><p>In <code>proc.go</code>, <code>itabsinit</code> will init the <code>itabTable</code> with the current <code>activeModules</code> information.
The <code>itabsinit</code> function will read the <code>itablinks</code> from each module and add them to the global hash table.</p><p>During the runtime, the <code>getitab</code> function will also build more items dynamically and fill the hash table accordingly.</p><p><code>itablinks</code> was produced for each module during the linking stage, and contains an array of <code>itab</code>.
<code>itab</code> is generated by writeITab function (code path: <code>cmd/compile/internal/reflectdata/reflect.go</code>),
used to store the type link between a concrete type (<code>_type</code> field) implementing an interface (<code>inter</code> field).
If <code>_type</code> doesn&rsquo;t implement <code>inter</code>, <code>fun</code> will be empty; else it will save the methods of <code>_type</code> implementing <code>inter</code> (not all methods of <code>_type</code>).</p><h2 id=runtime-type-assertion>Runtime Type Assertion<a hidden class=anchor aria-hidden=true href=#runtime-type-assertion>#</a></h2><ul><li>Code Path: <code>src/cmd/compile/internal/ssagen/ssa.go</code></li></ul><p>A type assertion is something like <code>y = x.(T)</code>, it&rsquo;s executed during runtime instead of compiling stage (e.g. generics).
The SSA module will generate the code with <code>dottype</code> function.</p><h2 id=interface-type-conversion>Interface Type Conversion<a hidden class=anchor aria-hidden=true href=#interface-type-conversion>#</a></h2><ul><li>Code Path: <code>src/cmd/compile/internal/walk/convert.go</code></li></ul><p>Interface-to-interface conversion is done during IR walking, <code>walkConvInterface</code> will check the types of source and destination types,
and only an interface-to-interface conversion needs a runtime call to <code>convI2I</code>.</p><p>Concrete type to interface conversion is done by <code>walkConvIData</code>. It will use <code>dataWordFuncName</code> to check the correct conversion implementation defined in <code>iface.go</code>.</p><h2 id=runtime-interface-method-call>Runtime Interface Method Call<a hidden class=anchor aria-hidden=true href=#runtime-interface-method-call>#</a></h2><ul><li>Code Path: <code>src/cmd/compile/internal/walk/expr.go</code></li></ul><p>An interface call (<code>x.A()</code>) will be walked by <code>walkCall</code>. Note that <code>ir.ODOTINTER</code> are <code>ir.OCALLINTER</code> the same for an interface,
because interfaces don&rsquo;t have any fields so they&rsquo;ll always be method calls.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kassiansun.github.io/tags/go/>go</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://kassiansun.github.io/>Kassian Sun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>