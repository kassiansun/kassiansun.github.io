<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Travesal Through The Go Compiler, Part 2 | Kassian Sun</title><meta name=keywords content="go"><meta name=description content="Builder.build Builder.build generate an archive for a single package.
Builder.build gets building information from two sources: internal/cfg package. It contains some global variables saving build flags. load.Package. It contains information for the current building package. Builder.build will build a need flag, finish the step and uncheck the finished bits one by one. Set up caching information by action, its package, and package&rsquo;s target. Set up objects output directory. Setup cgo cache & vet cache."><meta name=author content><link rel=canonical href=https://kassiansun.github.io/posts/go-source-code-part-2/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kassiansun.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kassiansun.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kassiansun.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kassiansun.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kassiansun.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.103.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-213473194-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Travesal Through The Go Compiler, Part 2"><meta property="og:description" content="Builder.build Builder.build generate an archive for a single package.
Builder.build gets building information from two sources: internal/cfg package. It contains some global variables saving build flags. load.Package. It contains information for the current building package. Builder.build will build a need flag, finish the step and uncheck the finished bits one by one. Set up caching information by action, its package, and package&rsquo;s target. Set up objects output directory. Setup cgo cache & vet cache."><meta property="og:type" content="article"><meta property="og:url" content="https://kassiansun.github.io/posts/go-source-code-part-2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-16T15:16:23+08:00"><meta property="article:modified_time" content="2022-09-16T15:16:23+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Travesal Through The Go Compiler, Part 2"><meta name=twitter:description content="Builder.build Builder.build generate an archive for a single package.
Builder.build gets building information from two sources: internal/cfg package. It contains some global variables saving build flags. load.Package. It contains information for the current building package. Builder.build will build a need flag, finish the step and uncheck the finished bits one by one. Set up caching information by action, its package, and package&rsquo;s target. Set up objects output directory. Setup cgo cache & vet cache."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kassiansun.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Travesal Through The Go Compiler, Part 2","item":"https://kassiansun.github.io/posts/go-source-code-part-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Travesal Through The Go Compiler, Part 2","name":"Travesal Through The Go Compiler, Part 2","description":"Builder.build Builder.build generate an archive for a single package.\nBuilder.build gets building information from two sources: internal/cfg package. It contains some global variables saving build flags. load.Package. It contains information for the current building package. Builder.build will build a need flag, finish the step and uncheck the finished bits one by one. Set up caching information by action, its package, and package\u0026rsquo;s target. Set up objects output directory. Setup cgo cache \u0026amp; vet cache.","keywords":["go"],"articleBody":"Builder.build Builder.build generate an archive for a single package.\nBuilder.build gets building information from two sources: internal/cfg package. It contains some global variables saving build flags. load.Package. It contains information for the current building package. Builder.build will build a need flag, finish the step and uncheck the finished bits one by one. Set up caching information by action, its package, and package’s target. Set up objects output directory. Setup cgo cache \u0026 vet cache. Set up building target directory. Set up non-Go files overlay. This step is to copy the non-Go files to the object directory. Preprocess coverage files and replace the file path of original *.go files. It runs go tool cover -mode=b.coverMode -var=\"varName\" -o dst.go src.go to generate the coverage files. Build cgo files. After the build, the cfiles will be cleared and generated go files will be added to gofiles Cache all source files. It’s all *.go files now Generate import configuration and package dependencies information. Generate embedded files configuration. Run BuildToolchain.gc. This is the actual go build stage. Run BuildToolchain.cc. This is the actual cgo build stage. Run BuildToolchain.as. This is the actual *.s build stage. Run BuildToolchain.pack. This will generate the object archive (*.a). Update the BuildID accordingly. Builder.link Builder.link links a package and generates the final binary. It’s very simple compared with the build stage.\nGenerate the link import cfg Set up linking target directory. Run BuildToolchain.ld. Update the BuildID accordingly. What’s Next BuildToolchain steps What’s BuildID and how it’s generated and used. ","wordCount":"249","inLanguage":"en","datePublished":"2022-09-16T15:16:23+08:00","dateModified":"2022-09-16T15:16:23+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://kassiansun.github.io/posts/go-source-code-part-2/"},"publisher":{"@type":"Organization","name":"Kassian Sun","logo":{"@type":"ImageObject","url":"https://kassiansun.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kassiansun.github.io/ accesskey=h title="Kassian Sun (Alt + H)">Kassian Sun</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://kassiansun.github.io/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Travesal Through The Go Compiler, Part 2</h1><div class=post-meta><span title='2022-09-16 15:16:23 +0800 +0800'>September 16, 2022</span></div></header><div class=post-content><h2 id=builderbuild><code>Builder.build</code><a hidden class=anchor aria-hidden=true href=#builderbuild>#</a></h2><p><code>Builder.build</code> generate an archive for a single package.</p><ul><li><code>Builder.build</code> gets building information from two sources:<ul><li><code>internal/cfg</code> package. It contains some global variables saving build flags.</li><li><code>load.Package</code>. It contains information for the current building package.</li><li><code>Builder.build</code> will build a <code>need</code> flag, finish the step and uncheck the finished bits one by one.</li></ul></li><li>Set up caching information by action, its package, and package&rsquo;s target.</li><li>Set up objects output directory.</li><li>Setup <code>cgo</code> cache & <code>vet</code> cache.</li><li>Set up building target directory.</li><li>Set up non-Go files overlay. This step is to copy the non-Go files to the object directory.</li><li>Preprocess coverage files and replace the file path of original <code>*.go</code> files.<ul><li>It runs <code>go tool cover -mode=b.coverMode -var="varName" -o dst.go src.go</code> to generate the coverage files.</li></ul></li><li>Build <code>cgo</code> files.<ul><li>After the build, the <code>cfiles</code> will be cleared and generated go files will be added to <code>gofiles</code></li></ul></li><li>Cache all source files. It&rsquo;s all <code>*.go</code> files now</li><li>Generate import configuration and package dependencies information.</li><li>Generate embedded files configuration.</li><li>Run <code>BuildToolchain.gc</code>. This is the actual <code>go</code> build stage.</li><li>Run <code>BuildToolchain.cc</code>. This is the actual <code>cgo</code> build stage.</li><li>Run <code>BuildToolchain.as</code>. This is the actual <code>*.s</code> build stage.</li><li>Run <code>BuildToolchain.pack</code>. This will generate the object archive (<code>*.a</code>).</li><li>Update the <code>BuildID</code> accordingly.</li></ul><h2 id=builderlink><code>Builder.link</code><a hidden class=anchor aria-hidden=true href=#builderlink>#</a></h2><p><code>Builder.link</code> links a package and generates the final binary. It&rsquo;s very simple compared with the build stage.</p><ul><li>Generate the link import cfg</li><li>Set up linking target directory.</li><li>Run <code>BuildToolchain.ld</code>.</li><li>Update the <code>BuildID</code> accordingly.</li></ul><h2 id=whats-next>What&rsquo;s Next<a hidden class=anchor aria-hidden=true href=#whats-next>#</a></h2><ul><li>BuildToolchain steps</li><li>What&rsquo;s BuildID and how it&rsquo;s generated and used.</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kassiansun.github.io/tags/go/>go</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://kassiansun.github.io/>Kassian Sun</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>