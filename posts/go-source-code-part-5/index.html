<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Travesal Through The Go Compiler, Part 5 | Kassian Sun</title>
<meta name=keywords content="go"><meta name=description content="irgen.generate Check each file&rsquo;s pragma list and DeclList. Generate ir.Decl for type declarations. Generate ir.Decl for other declarations. Process later functions, this step is for the same purpose as type check. Type-check CallExpr again. Check missing function bodies. Build generic instantiations. It scans calls and generated needed methods. Remove all generic Decl&rsquo;s. After irgen.generate, g.target.Decls will be the final Decl&rsquo;s to generate.
enqueueFunc and compileFunctions This step is the compile step of cmd/compile, it happens after type checking and IR generation."><meta name=author content><link rel=canonical href=https://blog.kassiansun.com/posts/go-source-code-part-5/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.kassiansun.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.kassiansun.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.kassiansun.com/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.kassiansun.com/apple-touch-icon.png><link rel=mask-icon href=https://blog.kassiansun.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.kassiansun.com/posts/go-source-code-part-5/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-E9FSQ1R0HV"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-E9FSQ1R0HV")}</script><meta property="og:title" content="Travesal Through The Go Compiler, Part 5"><meta property="og:description" content="irgen.generate Check each file&rsquo;s pragma list and DeclList. Generate ir.Decl for type declarations. Generate ir.Decl for other declarations. Process later functions, this step is for the same purpose as type check. Type-check CallExpr again. Check missing function bodies. Build generic instantiations. It scans calls and generated needed methods. Remove all generic Decl&rsquo;s. After irgen.generate, g.target.Decls will be the final Decl&rsquo;s to generate.
enqueueFunc and compileFunctions This step is the compile step of cmd/compile, it happens after type checking and IR generation."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.kassiansun.com/posts/go-source-code-part-5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-19T10:54:34+08:00"><meta property="article:modified_time" content="2022-09-19T10:54:34+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Travesal Through The Go Compiler, Part 5"><meta name=twitter:description content="irgen.generate Check each file&rsquo;s pragma list and DeclList. Generate ir.Decl for type declarations. Generate ir.Decl for other declarations. Process later functions, this step is for the same purpose as type check. Type-check CallExpr again. Check missing function bodies. Build generic instantiations. It scans calls and generated needed methods. Remove all generic Decl&rsquo;s. After irgen.generate, g.target.Decls will be the final Decl&rsquo;s to generate.
enqueueFunc and compileFunctions This step is the compile step of cmd/compile, it happens after type checking and IR generation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.kassiansun.com/posts/"},{"@type":"ListItem","position":2,"name":"Travesal Through The Go Compiler, Part 5","item":"https://blog.kassiansun.com/posts/go-source-code-part-5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Travesal Through The Go Compiler, Part 5","name":"Travesal Through The Go Compiler, Part 5","description":"irgen.generate Check each file\u0026rsquo;s pragma list and DeclList. Generate ir.Decl for type declarations. Generate ir.Decl for other declarations. Process later functions, this step is for the same purpose as type check. Type-check CallExpr again. Check missing function bodies. Build generic instantiations. It scans calls and generated needed methods. Remove all generic Decl\u0026rsquo;s. After irgen.generate, g.target.Decls will be the final Decl\u0026rsquo;s to generate.\nenqueueFunc and compileFunctions This step is the compile step of cmd/compile, it happens after type checking and IR generation.","keywords":["go"],"articleBody":"irgen.generate Check each file’s pragma list and DeclList. Generate ir.Decl for type declarations. Generate ir.Decl for other declarations. Process later functions, this step is for the same purpose as type check. Type-check CallExpr again. Check missing function bodies. Build generic instantiations. It scans calls and generated needed methods. Remove all generic Decl’s. After irgen.generate, g.target.Decls will be the final Decl’s to generate.\nenqueueFunc and compileFunctions This step is the compile step of cmd/compile, it happens after type checking and IR generation.\nenqueueFunc There’re some operations unsafe for parallel, enqueueFunc will handle these steps single-threaded.\nFor body-less functions:\nInitialize LSym and with-body text symbol (if it has a function body). Calculate the size and alignment of the functions. Generate the ABIConfig for body-less functions (ssaConfig.ABI0). Analyze the function call parameters, this step depends on the ABI’s number of registers. Each parameter will be passed by the stack or registers. Put the LSym of function to the global Link context. Generate the ArgInfo for body-less functions, and write the generated LSym. For other functions, call prepareFunc to set-up the ir.Func:\nInitialize LSym and with-body text symbol (if it has a function body). Calculate the size and alignment of the functions. Walk all statements of the function and generate the ir structures. Different kinds of statements will have different walking logic. compileFunctions If race detection is enabled, compile the code in random order. Otherwise, compile the largest function first. For each function: Call ssagen.Compile for each ir.Func. Recursively compile the closures inside the function. Whats’Next ssagen.Compile ","wordCount":"253","inLanguage":"en","datePublished":"2022-09-19T10:54:34+08:00","dateModified":"2022-09-19T10:54:34+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.kassiansun.com/posts/go-source-code-part-5/"},"publisher":{"@type":"Organization","name":"Kassian Sun","logo":{"@type":"ImageObject","url":"https://blog.kassiansun.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.kassiansun.com/ accesskey=h title="Kassian Sun (Alt + H)">Kassian Sun</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.kassiansun.com/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Travesal Through The Go Compiler, Part 5</h1><div class=post-meta><span title='2022-09-19 10:54:34 +0800 +0800'>September 19, 2022</span></div></header><div class=post-content><h2 id=irgengenerate><code>irgen.generate</code><a hidden class=anchor aria-hidden=true href=#irgengenerate>#</a></h2><ul><li>Check each file&rsquo;s pragma list and <code>DeclList</code>.</li><li>Generate <code>ir.Decl</code> for <code>type</code> declarations.</li><li>Generate <code>ir.Decl</code> for other declarations.</li><li>Process later functions, this step is for the same purpose as type check.</li><li>Type-check <code>CallExpr</code> again.</li><li>Check missing function bodies.</li><li>Build generic instantiations. It scans calls and generated needed methods.</li><li>Remove all generic <code>Decl</code>&rsquo;s.</li></ul><p>After <code>irgen.generate</code>, <code>g.target.Decls</code> will be the final <code>Decl</code>&rsquo;s to generate.</p><h2 id=enqueuefunc-and-compilefunctions><code>enqueueFunc</code> and <code>compileFunctions</code><a hidden class=anchor aria-hidden=true href=#enqueuefunc-and-compilefunctions>#</a></h2><p>This step is the compile step of <code>cmd/compile</code>, it happens after type checking and IR generation.</p><h3 id=enqueuefunc><code>enqueueFunc</code><a hidden class=anchor aria-hidden=true href=#enqueuefunc>#</a></h3><p>There&rsquo;re some operations unsafe for parallel, <code>enqueueFunc</code> will handle these steps single-threaded.</p><p>For body-less functions:</p><ul><li>Initialize LSym and with-body text symbol (if it has a function body).</li><li>Calculate the size and alignment of the functions.</li><li>Generate the ABIConfig for body-less functions (<code>ssaConfig.ABI0</code>).</li><li>Analyze the function call parameters, this step depends on the ABI&rsquo;s number of registers. Each parameter will be passed by the stack or registers.</li><li>Put the LSym of function to the global Link context.</li><li>Generate the <code>ArgInfo</code> for body-less functions, and write the generated LSym.</li></ul><p>For other functions, call <code>prepareFunc</code> to set-up the <code>ir.Func</code>:</p><ul><li>Initialize LSym and with-body text symbol (if it has a function body).</li><li>Calculate the size and alignment of the functions.</li><li>Walk all statements of the function and generate the <code>ir</code> structures. Different kinds of statements will have different walking logic.</li></ul><h3 id=compilefunctions><code>compileFunctions</code><a hidden class=anchor aria-hidden=true href=#compilefunctions>#</a></h3><ul><li>If race detection is enabled, compile the code in random order. Otherwise, compile the largest function first.</li><li>For each function:<ul><li>Call <code>ssagen.Compile</code> for each <code>ir.Func</code>.</li><li>Recursively compile the closures inside the function.</li></ul></li></ul><h2 id=whatsnext>Whats&rsquo;Next<a hidden class=anchor aria-hidden=true href=#whatsnext>#</a></h2><ul><li>ssagen.Compile</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.kassiansun.com/tags/go/>Go</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.kassiansun.com/>Kassian Sun</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>